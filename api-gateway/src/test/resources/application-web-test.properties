# Test configuration for web integration tests
logging.level.com.library.apigateway=DEBUG
spring.jpa.hibernate.ddl-auto=create-drop
spring.main.allow-bean-definition-overriding=true

# Enable DataSource for tests (overrides main app exclusion)
spring.autoconfigure.exclude-filters=

# Disable main gRPC client config in tests
test.grpc.client.disabled=true

# Only exclude problematic auto-configurations, but keep GraphQL web enabled
spring.autoconfigure.exclude=\
  org.springframework.cloud.gateway.config.GatewayAutoConfiguration,\
  org.springframework.cloud.gateway.config.GatewayClassPathWarningAutoConfiguration,\
  org.springframework.cloud.gateway.config.GatewayMetricsAutoConfiguration,\
  graphql.kickstart.autoconfigure.tools.GraphQLJavaToolsAutoConfiguration,\
  net.devh.boot.grpc.client.autoconfigure.GrpcClientAutoConfiguration,\
  net.devh.boot.grpc.client.autoconfigure.GrpcClientHealthAutoConfiguration

# Use H2 in-memory database for tests
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# Disable Spring Cloud version compatibility check for tests
spring.cloud.compatibility-verifier.enabled=false

# gRPC test configuration
grpc.client.bookService.address=static://localhost:9091
grpc.client.userService.address=static://localhost:9092
grpc.client.bookService.negotiationType=plaintext
grpc.client.userService.negotiationType=plaintext